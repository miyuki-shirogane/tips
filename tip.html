<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ® 20Q Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      display: flex;
      justify-content: center;
      padding: 0; /* ç§»é™¤é¡µé¢é»˜è®¤å†…è¾¹è·ï¼Œç½®é¡¶æ˜¾ç¤º */
      margin: 0;
      align-items: flex-start; /* ç½®é¡¶å¯¹é½ */
      padding-top: 40px; /* é¡¶éƒ¨ä»…ç•™å°‘é‡é—´è·ï¼Œé¿å…è´´è¾¹ */
    }

    .container {
      width: 100%;
      max-width: 750px; /* åŠ å®½å®¹å™¨ï¼Œæ›´å¤§æ°” */
      display: flex;
      flex-direction: column;
      gap: 30px; /* åŠ å¤§å¡ç‰‡é—´è· */
      padding: 0 20px;
    }

    /* æ ‡é¢˜åŒºåŸŸ - æ”¾å¤§æ›´é†’ç›® */
    .header {
      text-align: center;
      padding: 15px 0;
      position: relative;
      margin-bottom: 10px;
    }

    .main-title {
      font-size: 48px; /* æ”¾å¤§æ ‡é¢˜ */
      color: #2d3748;
      font-weight: 800; /* åŠ ç²—æ›´é†’ç›® */
      letter-spacing: 1px; /* å­—é—´è·æ›´èˆ’å±• */
    }

    /* é€šç”¨æ“ä½œå¡ç‰‡æ ·å¼ - æ”¾å¤§æ›´å¤§æ°” */
    .card {
      background: #fff;
      border-radius: 28px; /* æ›´å¤§åœ†è§’ */
      box-shadow: 0 15px 35px rgba(0,0,0,0.1); /* æ›´æ˜æ˜¾é˜´å½± */
      padding: 45px 50px; /* åŠ å¤§å†…è¾¹è·ï¼Œæ›´é¥±æ»¡ */
      text-align: center;
      transition: transform 0.2s ease;
      width: 100%;
      max-width: 700px; /* åŠ å¤§å¡ç‰‡æœ€å¤§å®½åº¦ */
      margin: 0 auto; /* å±…ä¸­ */
    }

    .card:hover {
      transform: translateY(-4px);
    }

    /* æ‰“èµå¡ç‰‡ - æš–è‰²è°ƒ */
    .tip-card {
      border-top: 6px solid #48bb78; /* åŠ ç²—é¡¶éƒ¨è¾¹æ¡† */
    }

    /* åº”ç”¨å¡ç‰‡ - å†·è‰²è°ƒ */
    .app-card {
      border-top: 6px solid #4299e1; /* åŠ ç²—é¡¶éƒ¨è¾¹æ¡† */
    }

    /* å¡ç‰‡æ ‡é¢˜ - æ”¾å¤§æ›´æ¸…æ™° */
    .card-title {
      font-size: 32px; /* å¤§å¹…æ”¾å¤§å¡ç‰‡æ ‡é¢˜ */
      color: #2d3748;
      font-weight: 700;
      margin-bottom: 30px; /* åŠ å¤§é—´è· */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    /* æŒ‰é’®é€šç”¨æ ·å¼ - æ”¾å¤§æ›´å¤§æ°” */
    .btn {
      padding: 28px 50px; /* åŠ å¤§æŒ‰é’®å†…è¾¹è· */
      font-size: 26px; /* æ”¾å¤§æŒ‰é’®æ–‡å­— */
      font-weight: 700;
      border-radius: 16px; /* æ›´å¤§åœ†è§’ */
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 15px 0; /* åŠ å¤§æŒ‰é’®é—´è· */
      width: 100%;
      border: none;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1); /* æ›´æ˜æ˜¾é˜´å½± */
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* ç¦ç”¨çŠ¶æ€ */
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    /* è¿æ¥é’±åŒ…æŒ‰é’® */
    #connectBtn {
      background: #e8f4ff;
      color: #4299e1;
    }

    #connectBtn:hover:not(:disabled) {
      background: #dbeafe;
    }

    /* æ‰“èµæŒ‰é’® */
    #tipBtn {
      background: #f0fdf4;
      color: #48bb78;
      display: none;
    }

    #tipBtn:hover:not(:disabled) {
      background: #dcfce7;
    }

    /* è¿›å…¥åº”ç”¨æŒ‰é’® */
    #enterAppBtn {
      background: #f5f3ff;
      color: #9f7aea;
    }

    #enterAppBtn:hover:not(:disabled) {
      background: #ede9fe;
    }

    /* çŠ¶æ€æç¤º - æ”¾å¤§æ›´æ¸…æ™° */
    .status {
      font-size: 22px; /* æ”¾å¤§çŠ¶æ€æ–‡å­— */
      margin: 25px 0;
      min-height: 30px;
      font-weight: 500;
    }

    .status.success {
      color: #38a169;
    }

    .status.error {
      color: #e53e3e;
    }

    .status.warning {
      color: #dd6b20;
    }

    /* é¡µè„šè¯´æ˜ - æ”¾å¤§æ›´æ¸…æ™° */
    .card-footer {
      margin-top: 25px;
      font-size: 18px; /* æ”¾å¤§é¡µè„šæ–‡å­— */
      color: #718096; /* åŠ æ·±é¢œè‰²æ›´æ¸…æ™° */
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- æ ‡é¢˜åŒº - ç½®é¡¶æ— ç©ºè¡Œ -->
    <div class="header">
      <h1 class="main-title">ğŸ® 20Q Game</h1>
    </div>

    <!-- æ‰“èµæ“ä½œåŒº - å¤§æ°”å¡ç‰‡ -->
    <div class="card tip-card">
      <h2 class="card-title">
        <span>â˜•ï¸ ç»™ä½œè€…ä¹°ä¸€æ¯å’–å•¡</span>
      </h2>
      <div id="status" class="status">æ£€æµ‹é’±åŒ…ç¯å¢ƒä¸­...</div>
      <button id="connectBtn" class="btn" disabled>è¿æ¥ SupeRISE é’±åŒ…</button>
      <button id="tipBtn" class="btn">æ‰“èµ 2000 CKB æ”¯æŒä½œè€…</button>
      <p class="card-footer">æ„Ÿè°¢æ”¯æŒ â¤ï¸</p>
    </div>

    <!-- åº”ç”¨å…¥å£åŒº - å¤§æ°”å¡ç‰‡ -->
    <div class="card app-card">
      <h2 class="card-title">
        <span>ğŸ® è¿›å…¥ 20Q æ¸¸æˆåº”ç”¨</span>
      </h2>
      <a href="http://192.168.12.100:8501" target="_self" id="enterAppBtn" class="btn">
        ç«‹å³è¿›å…¥åº”ç”¨
      </a>
      <p class="card-footer">æ— éœ€æ‰“èµï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿›å…¥ ğŸš€</p>
    </div>
  </div>

  <script>
    // é…ç½®é¡¹
    const CONFIG = {
      CONNECT_TIMEOUT: 20000, // 20ç§’è¶…æ—¶
      TIP_ADDRESS: "ckt1qrfrwcdnvssswdwpn3s9v8fp87emat306ctjwsm3nmlkjg8qyza2cqgqqx4q8n46evp22qlt934kn93auhp8kgrmkggxvm0n",
      TIP_AMOUNT: 2000 * 10 ** 8, // 2000 CKB
      STREAMLIT_URL: "http://192.168.12.100:8501"
    };

    // å…¨å±€çŠ¶æ€
    let walletConnected = false;
    let connectTimer = null;

    // DOM å…ƒç´ 
    const statusEl = document.getElementById("status");
    const connectBtn = document.getElementById("connectBtn");
    const tipBtn = document.getElementById("tipBtn");
    const enterAppBtn = document.getElementById("enterAppBtn");

    // æ›´æ–°çŠ¶æ€æç¤º
    function updateStatus(text, type = "normal") {
      statusEl.textContent = text;
      statusEl.className = `status ${type}`;
    }

    // åˆå§‹åŒ–ï¼šæ£€æµ‹é’±åŒ…ç¯å¢ƒ
    function init() {
      // æ£€æµ‹é’±åŒ…ç¯å¢ƒ
      if (!window.superise) {
        updateStatus("é SupeRISE é’±åŒ…ç¯å¢ƒï¼Œè¯·åœ¨é’±åŒ…å†…æ‰“å¼€", "error");
        connectBtn.disabled = true;
        return;
      }

      updateStatus("å·²æ£€æµ‹åˆ° SupeRISE é’±åŒ…ï¼Œè¯·ç‚¹å‡»æŒ‰é’®è¿æ¥", "warning");
      connectBtn.disabled = false;
      // ç»‘å®šè¿æ¥æŒ‰é’®äº‹ä»¶
      connectBtn.addEventListener("click", connectWalletWithTimeout);
      // ç»‘å®šæ‰“èµæŒ‰é’®äº‹ä»¶
      tipBtn.addEventListener("click", handleTip);
    }

    // è¿æ¥é’±åŒ…
    async function connectWalletWithTimeout() {
      connectBtn.disabled = true;
      updateStatus("æ­£åœ¨è¯·æ±‚è¿æ¥é’±åŒ…ï¼Œè¯·åœ¨é’±åŒ…å†…ç¡®è®¤...", "warning");

      // è®¾ç½®è¶…æ—¶å®šæ—¶å™¨
      connectTimer = setTimeout(() => {
        updateStatus("è¿æ¥è¶…æ—¶ï¼Œè¯·é‡æ–°å°è¯•", "error");
        connectBtn.disabled = false;
        walletConnected = false;
      }, CONFIG.CONNECT_TIMEOUT);

      try {
        // æ˜¾å¼è¿æ¥é’±åŒ…
        const walletInfo = await window.superise.connectCkb();
        clearTimeout(connectTimer);

        // è¿æ¥æˆåŠŸ
        walletConnected = true;
        updateStatus("é’±åŒ…è¿æ¥æˆåŠŸï¼å¯ç‚¹å‡»æ‰“èµ", "success");
        connectBtn.style.display = "none";
        tipBtn.style.display = "block";
      } catch (error) {
        clearTimeout(connectTimer);
        updateStatus(`è¿æ¥å¤±è´¥ï¼š${error.message}`, "error");
        connectBtn.disabled = false;
        walletConnected = false;
      }
    }

    // æ‰“èµé€»è¾‘
    async function handleTip() {
      if (!walletConnected) {
        updateStatus("è¯·å…ˆè¿æ¥é’±åŒ…", "error");
        return;
      }

      try {
        updateStatus("æ­£åœ¨å‘èµ·è½¬è´¦ï¼Œè¯·åœ¨é’±åŒ…å†…ç¡®è®¤...", "warning");
        tipBtn.disabled = true;

        // è°ƒç”¨è½¬è´¦API
        const res = await window.superise.transferCKB(
          CONFIG.TIP_ADDRESS,
          CONFIG.TIP_AMOUNT,
          Date.now() + 120000 // 2åˆ†é’Ÿè¿‡æœŸ
        );

        // æ”¯ä»˜æˆåŠŸ
        updateStatus("æ‰“èµæˆåŠŸï¼æ„Ÿè°¢æ”¯æŒï½", "success");
        alert(`æ„Ÿè°¢æ”¯æŒï¼\näº¤æ˜“å“ˆå¸Œï¼š${res.txHash}`);
        // è‡ªåŠ¨è·³è½¬Streamlit
        window.location.href = CONFIG.STREAMLIT_URL;
      } catch (error) {
        updateStatus(`æ‰“èµå¤±è´¥ï¼š${error.message}`, "error");
        alert(`å·²å–æ¶ˆæˆ–å¤±è´¥ï¼š${error.message}`);
        tipBtn.disabled = false;
      }
    }

    // é¡µé¢åŠ è½½+Bridgeå°±ç»ªåˆå§‹åŒ–
    window.addEventListener("DOMContentLoaded", init);
    window.addEventListener("superiseReady", init);
  </script>
</body>
</html>