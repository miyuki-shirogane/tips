<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>â˜•ï¸ æ‰“èµ & è¿›å…¥åº”ç”¨</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      margin: 0;
      font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f2f2f2, #e6e6e6);
    }

    .card {
      margin-top: 6vh;
      background: #fff;
      padding: 80px 70px;
      border-radius: 36px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.18);
      text-align: center;
      width: 620px;
      max-width: 92%;
    }

    .emoji {
      font-size: 80px;
      margin-bottom: 28px;
      display: block;
    }

    h3 {
      font-size: 42px;
      margin: 0 0 36px;
      color: #222;
      font-weight: 600;
    }

    /* æŒ‰é’®é€šç”¨æ ·å¼ */
    .btn {
      padding: 24px 64px;
      font-size: 28px;
      font-weight: 600;
      color: #000;
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.18s ease;
      margin: 12px 0;
      width: 100%;
      box-sizing: border-box;
      text-decoration: none;
      display: inline-block;
    }

    .btn:hover {
      background: #fafafa;
      border-color: #999;
      transform: translateY(-1px);
    }

    .btn:active {
      background: #eee;
      transform: translateY(0);
    }

    /* æ‰“èµæŒ‰é’®æ ·å¼ */
    #tipBtn {
      border-color: #48bb78;
      color: #48bb78;
    }

    #tipBtn:hover:not(:disabled) {
      background: #f0fdf4;
      border-color: #38a169;
    }

    /* è¿›å…¥åº”ç”¨æŒ‰é’®æ ·å¼ */
    #enterAppBtn {
      border-color: #4299e1;
      color: #4299e1;
    }

    #enterAppBtn:hover:not(:disabled) {
      background: #e8f4ff;
      border-color: #3182ce;
    }

    /* çŠ¶æ€æç¤º */
    .status {
      font-size: 20px;
      margin: 24px 0;
      min-height: 24px;
    }

    .status.success {
      color: #38a169;
    }

    .status.error {
      color: #e53e3e;
    }

    .footer {
      margin-top: 44px;
      font-size: 17px;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="card">
    <span class="emoji">â˜•ï¸</span>
    <h3>æ¬¢è¿ä½¿ç”¨ï¼</h3>

    <!-- çŠ¶æ€æç¤º -->
    <div id="status" class="status">å·²æ£€æµ‹åˆ° SupeRISE é’±åŒ…ç¯å¢ƒ</div>

    <!-- æ‰“èµæŒ‰é’® -->
    <button id="tipBtn" class="btn">æ‰“èµ 2000 CKB æ”¯æŒä½œè€…</button>

    <!-- è¿›å…¥åº”ç”¨æŒ‰é’®ï¼ˆæ ¸å¿ƒè·³è½¬ï¼‰ -->
    <a href="http://192.168.12.100:8501" target="_self" id="enterAppBtn" class="btn">
      ğŸš€ è¿›å…¥åº”ç”¨ï¼ˆStreamlitï¼‰
    </a>

    <div class="footer">
      æ„Ÿè°¢æ”¯æŒ â¤ï¸
    </div>
  </div>

  <script>
    // é…ç½®é¡¹
    const CONFIG = {
      TIP_ADDRESS: "ckt1qrfrwcdnvssswdwpn3s9v8fp87emat306ctjwsm3nmlkjg8qyza2cqgqqx4q8n46evp22qlt934kn93auhp8kgrmkggxvm0n",
      TIP_AMOUNT: 2000 * 10 ** 8, // 2000 CKB
      STREAMLIT_URL: "http://192.168.12.100:8501"
    };

    // DOM å…ƒç´ 
    const statusEl = document.getElementById("status");
    const tipBtn = document.getElementById("tipBtn");
    const enterAppBtn = document.getElementById("enterAppBtn");

    // åˆå§‹åŒ–ï¼šæ£€æµ‹é’±åŒ…ç¯å¢ƒ
    function init() {
      if (!window.superise) {
        updateStatus("é SupeRISE é’±åŒ…ç¯å¢ƒï¼Œè¯·åœ¨é’±åŒ…å†…æ‰“å¼€", "error");
        tipBtn.disabled = true;
        return;
      }
      updateStatus("å·²æ£€æµ‹åˆ° SupeRISE é’±åŒ…ï¼Œå¯ç›´æ¥æ‰“èµæˆ–è¿›å…¥åº”ç”¨", "success");
    }

    // æ›´æ–°çŠ¶æ€æç¤º
    function updateStatus(text, type = "normal") {
      statusEl.textContent = text;
      statusEl.className = `status ${type}`;
    }

    // æ‰“èµé€»è¾‘ï¼ˆä¿ç•™åŸç§’è¿åŠŸèƒ½ï¼‰
    async function handleTip() {
      try {
        updateStatus("æ­£åœ¨å‘èµ·è½¬è´¦ï¼Œè¯·åœ¨é’±åŒ…å†…ç¡®è®¤...", "normal");
        tipBtn.disabled = true;

        const res = await window.superise.transferCKB(
          CONFIG.TIP_ADDRESS,
          CONFIG.TIP_AMOUNT,
          Date.now() + 120000 // 2åˆ†é’Ÿè¿‡æœŸ
        );

        updateStatus("æ‰“èµæˆåŠŸï¼æ„Ÿè°¢æ”¯æŒï½", "success");
        alert(`æ„Ÿè°¢æ”¯æŒï¼\näº¤æ˜“å“ˆå¸Œï¼š${res.txHash}`);
        // æ‰“èµåè‡ªåŠ¨è·³è½¬åº”ç”¨
        window.location.href = CONFIG.STREAMLIT_URL;
      } catch (error) {
        updateStatus(`æ‰“èµå¤±è´¥ï¼š${error.message}`, "error");
        alert(`å·²å–æ¶ˆæˆ–å¤±è´¥ï¼š${error.message}`);
        tipBtn.disabled = false;
      }
    }

    // ç»‘å®šäº‹ä»¶
    tipBtn.addEventListener("click", handleTip);
    window.addEventListener("DOMContentLoaded", init);
    window.addEventListener("superiseReady", init);
  </script>
</body>
</html>